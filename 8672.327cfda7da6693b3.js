(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8672],{7423:(q,B,b)=>{"use strict";b.d(B,{Uw:()=>n,fo:()=>f,xz:()=>j});var g=b(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var u=(()=>{return(o=u||(u={})).Unimplemented="UNIMPLEMENTED",o.Unavailable="UNAVAILABLE",u;var o})();class j extends Error{constructor(t,r,l){super(t),this.message=t,this.code=r,this.data=l}}const I=o=>{var t,r,l,h,c;const v=o.CapacitorCustomPlatform||null,d=o.Capacitor||{},F=d.Plugins=d.Plugins||{},y=o.CapacitorPlatforms,z=(null===(t=null==y?void 0:y.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==v?v.name:(o=>{var t,r;return null!=o&&o.androidBridge?"android":null!==(r=null===(t=null==o?void 0:o.webkit)||void 0===t?void 0:t.messageHandlers)&&void 0!==r&&r.bridge?"ios":"web"})(o)),le=(null===(r=null==y?void 0:y.currentPlatform)||void 0===r?void 0:r.isNativePlatform)||(()=>"web"!==z()),de=(null===(l=null==y?void 0:y.currentPlatform)||void 0===l?void 0:l.isPluginAvailable)||(w=>{const P=te.get(w);return!!(null!=P&&P.platforms.has(z())||oe(w))}),oe=(null===(h=null==y?void 0:y.currentPlatform)||void 0===h?void 0:h.getPluginHeader)||(w=>{var P;return null===(P=d.PluginHeaders)||void 0===P?void 0:P.find(D=>D.name===w)}),te=new Map,me=(null===(c=null==y?void 0:y.currentPlatform)||void 0===c?void 0:c.registerPlugin)||((w,P={})=>{const D=te.get(w);if(D)return console.warn(`Capacitor plugin "${w}" already registered. Cannot register plugins twice.`),D.proxy;const G=z(),R=oe(w);let Z;const ve=function(){var k=(0,g.Z)(function*(){return!Z&&G in P?Z=Z="function"==typeof P[G]?yield P[G]():P[G]:null!==v&&!Z&&"web"in P&&(Z=Z="function"==typeof P.web?yield P.web():P.web),Z});return function(){return k.apply(this,arguments)}}(),re=k=>{let $;const T=(...H)=>{const M=ve().then(S=>{const W=((k,$)=>{var T,H;if(!R){if(k)return null===(H=k[$])||void 0===H?void 0:H.bind(k);throw new j(`"${w}" plugin is not implemented on ${G}`,u.Unimplemented)}{const M=null==R?void 0:R.methods.find(S=>$===S.name);if(M)return"promise"===M.rtype?S=>d.nativePromise(w,$.toString(),S):(S,W)=>d.nativeCallback(w,$.toString(),S,W);if(k)return null===(T=k[$])||void 0===T?void 0:T.bind(k)}})(S,k);if(W){const X=W(...H);return $=null==X?void 0:X.remove,X}throw new j(`"${w}.${k}()" is not implemented on ${G}`,u.Unimplemented)});return"addListener"===k&&(M.remove=(0,g.Z)(function*(){return $()})),M};return T.toString=()=>`${k.toString()}() { [capacitor code] }`,Object.defineProperty(T,"name",{value:k,writable:!1,configurable:!1}),T},se=re("addListener"),ie=re("removeListener"),be=(k,$)=>{const T=se({eventName:k},$),H=function(){var S=(0,g.Z)(function*(){const W=yield T;ie({eventName:k,callbackId:W},$)});return function(){return S.apply(this,arguments)}}(),M=new Promise(S=>T.then(()=>S({remove:H})));return M.remove=(0,g.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield H()}),M},ne=new Proxy({},{get(k,$){switch($){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return R?be:se;case"removeListener":return ie;default:return re($)}}});return F[w]=ne,te.set(w,{name:w,proxy:ne,platforms:new Set([...Object.keys(P),...R?[G]:[]])}),ne});return d.convertFileSrc||(d.convertFileSrc=w=>w),d.getPlatform=z,d.handleError=w=>o.console.error(w),d.isNativePlatform=le,d.isPluginAvailable=de,d.pluginMethodNoop=(w,P,D)=>Promise.reject(`${D} does not have an implementation of "${P}".`),d.registerPlugin=me,d.Exception=j,d.DEBUG=!!d.DEBUG,d.isLoggingEnabled=!!d.isLoggingEnabled,d.platform=d.getPlatform(),d.isNative=d.isNativePlatform(),d},e=(o=>o.Capacitor=I(o))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),f=e.registerPlugin;class n{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,r){var l=this;this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(r);const c=this.windowListeners[t];c&&!c.registered&&this.addWindowListener(c);const v=function(){var F=(0,g.Z)(function*(){return l.removeListener(t,r)});return function(){return F.apply(this,arguments)}}(),d=Promise.resolve({remove:v});return Object.defineProperty(d,"remove",{value:(F=(0,g.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield v()}),function(){return F.apply(this,arguments)})}),d;var F}removeAllListeners(){var t=this;return(0,g.Z)(function*(){t.listeners={};for(const r in t.windowListeners)t.removeWindowListener(t.windowListeners[r]);t.windowListeners={}})()}notifyListeners(t,r){const l=this.listeners[t];l&&l.forEach(h=>h(r))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,r){this.windowListeners[r]={registered:!1,windowEventName:t,pluginEventName:r,handler:l=>{this.notifyListeners(r,l)}}}unimplemented(t="not implemented"){return new e.Exception(t,u.Unimplemented)}unavailable(t="not available"){return new e.Exception(t,u.Unavailable)}removeListener(t,r){var l=this;return(0,g.Z)(function*(){const h=l.listeners[t];if(!h)return;const c=h.indexOf(r);l.listeners[t].splice(c,1),l.listeners[t].length||l.removeWindowListener(l.windowListeners[t])})()}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}const i=o=>encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),a=o=>o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class p extends n{getCookies(){return(0,g.Z)(function*(){const t=document.cookie,r={};return t.split(";").forEach(l=>{if(l.length<=0)return;let[h,c]=l.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");h=a(h).trim(),c=a(c).trim(),r[h]=c}),r})()}setCookie(t){return(0,g.Z)(function*(){try{const r=i(t.key),l=i(t.value),h=`; expires=${(t.expires||"").replace("expires=","")}`,c=(t.path||"/").replace("path=",""),v=null!=t.url&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${r}=${l||""}${h}; path=${c}; ${v};`}catch(r){return Promise.reject(r)}})()}deleteCookie(t){return(0,g.Z)(function*(){try{document.cookie=`${t.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}})()}clearCookies(){return(0,g.Z)(function*(){try{const t=document.cookie.split(";")||[];for(const r of t)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(t){return Promise.reject(t)}})()}clearAllCookies(){var t=this;return(0,g.Z)(function*(){try{yield t.clearCookies()}catch(r){return Promise.reject(r)}})()}}f("CapacitorCookies",{web:()=>new p});const U=function(){var o=(0,g.Z)(function*(t){return new Promise((r,l)=>{const h=new FileReader;h.onload=()=>{const c=h.result;r(c.indexOf(",")>=0?c.split(",")[1]:c)},h.onerror=c=>l(c),h.readAsDataURL(t)})});return function(r){return o.apply(this,arguments)}}();class ce extends n{request(t){return(0,g.Z)(function*(){const r=((o,t={})=>{const r=Object.assign({method:o.method||"GET",headers:o.headers},t),h=((o={})=>{const t=Object.keys(o);return Object.keys(o).map(h=>h.toLocaleLowerCase()).reduce((h,c,v)=>(h[c]=o[t[v]],h),{})})(o.headers)["content-type"]||"";if("string"==typeof o.data)r.body=o.data;else if(h.includes("application/x-www-form-urlencoded")){const c=new URLSearchParams;for(const[v,d]of Object.entries(o.data||{}))c.set(v,d);r.body=c.toString()}else if(h.includes("multipart/form-data")){const c=new FormData;if(o.data instanceof FormData)o.data.forEach((d,F)=>{c.append(F,d)});else for(const d of Object.keys(o.data))c.append(d,o.data[d]);r.body=c;const v=new Headers(r.headers);v.delete("content-type"),r.headers=v}else(h.includes("application/json")||"object"==typeof o.data)&&(r.body=JSON.stringify(o.data));return r})(t,t.webFetchExtra),l=((o,t=!0)=>o?Object.entries(o).reduce((l,h)=>{const[c,v]=h;let d,F;return Array.isArray(v)?(F="",v.forEach(y=>{d=t?encodeURIComponent(y):y,F+=`${c}=${d}&`}),F.slice(0,-1)):(d=t?encodeURIComponent(v):v,F=`${c}=${d}`),`${l}&${F}`},"").substr(1):null)(t.params,t.shouldEncodeUrlParams),h=l?`${t.url}?${l}`:t.url,c=yield fetch(h,r),v=c.headers.get("content-type")||"";let F,y,{responseType:d="text"}=c.ok?t:{};switch(v.includes("application/json")&&(d="json"),d){case"arraybuffer":case"blob":y=yield c.blob(),F=yield U(y);break;case"json":F=yield c.json();break;default:F=yield c.text()}const Q={};return c.headers.forEach((z,ee)=>{Q[ee]=z}),{data:F,headers:Q,status:c.status,url:c.url}})()}get(t){var r=this;return(0,g.Z)(function*(){return r.request(Object.assign(Object.assign({},t),{method:"GET"}))})()}post(t){var r=this;return(0,g.Z)(function*(){return r.request(Object.assign(Object.assign({},t),{method:"POST"}))})()}put(t){var r=this;return(0,g.Z)(function*(){return r.request(Object.assign(Object.assign({},t),{method:"PUT"}))})()}patch(t){var r=this;return(0,g.Z)(function*(){return r.request(Object.assign(Object.assign({},t),{method:"PATCH"}))})()}delete(t){var r=this;return(0,g.Z)(function*(){return r.request(Object.assign(Object.assign({},t),{method:"DELETE"}))})()}}f("CapacitorHttp",{web:()=>new ce})},8672:(q,B,b)=>{"use strict";b.d(B,{j:()=>f});var g=b(5861),x=b(529),C=b(9808),O=b(3905),E=b(2340),V=b(2848),L=b.n(V),u=b(4650),j=b(7556);const I=(0,b(7423).fo)("Geolocation",{web:()=>b.e(4561).then(b.bind(b,4561)).then(m=>new m.GeolocationWeb)});let N=(()=>{class m{constructor(){this.coords={latitude:0,longitude:0,accuracy:0}}getLocation(){var n=this;return(0,g.Z)(function*(){const s=yield I.getCurrentPosition();return n.coords.latitude=s.coords.latitude,n.coords.latitude=s.coords.longitude,n.coords.accuracy=s.coords.accuracy,n.coords})()}}return m.\u0275fac=function(n){return new(n||m)},m.\u0275prov=u.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();var e=b(1762);let f=(()=>{class m{constructor(n,s,i,a){this.http=n,this.authService=s,this.geoService=i,this.afs=a,this.url=E.N.url,this.token=this.authService.getJWT()}getRecommendations(){var n=this;return(0,g.Z)(function*(){const i={tracks:(yield n.getTracks()).map(a=>a.name)};try{const a=(yield(0,C.n)(n.http.put(`${n.url}recommendations`,i,{headers:{Authorization:`Bearer ${n.token}`}}))).tracks;return console.log(a),a}catch(a){return a instanceof x.UA&&500===a.status&&console.log("Error updating track"),[]}})()}searchTracksSpotify(n,s=0){var i=this;return(0,g.Z)(function*(){try{return(yield(0,C.n)(i.http.get(`${i.url}search/${encodeURI(n)}?offset=${s}`))).tracks.items.map(p=>({_id:p.id,...p,id:void 0}))}catch(a){return console.log(a),[]}})()}searchTracks(n,s="name"){var i=this;return(0,g.Z)(function*(){try{return yield(0,C.n)(i.http.get(`${i.url}tracks/search?${s}=${encodeURI(n)}`,{headers:{Authorization:`Bearer ${i.token}`}}))}catch(a){if(a instanceof x.UA){if(404===a.status)throw new Error("Track not found");if(500===a.status)throw new Error("Error getting track");if(0===a.status)throw new Error("Error connecting to server")}throw a}})()}getTrack(n){var s=this;return(0,g.Z)(function*(){try{const i=(0,C.n)(s.http.get(`${s.url}tracks/${n}`,{headers:{Authorization:`Bearer ${s.token}`}})),a=(0,O.z)(s.afs.doc(`tracks/${n}`).valueChanges()),[p,A]=yield Promise.all([i,a]);return p||A}catch(i){if(i instanceof x.UA){if(404===i.status)throw new Error("Track not found");if(500===i.status)throw new Error("Error getting track");if(0===i.status)throw new Error("Error connecting to server")}throw i}})()}getTracks(){var n=this;return(0,g.Z)(function*(){try{const s=(0,C.n)(n.http.get(`${n.url}tracks/`,{headers:{Authorization:`Bearer ${n.token}`}})),i=(0,O.z)(n.afs.collection("tracks").valueChanges()),[a,p]=yield Promise.all([s,i]);return a.concat(p.filter(A=>!a.find(U=>U._id===A._id)))}catch(s){if(s instanceof x.UA){if(500===s.status)throw new Error("Error getting track");if(0===s.status)throw new Error("Error connecting to server")}console.error(s)}return[]})()}insertTrack(n){var s=this;return(0,g.Z)(function*(){n._id=L()().toHexString(),n.album.name=n.name,n.album=JSON.parse(JSON.stringify(n.album));const i=[n];return yield s.insertTracks(i)})()}insertTracks(n){var s=this;return(0,g.Z)(function*(){const i=s.afs.firestore.batch();let a;try{a=yield s.geoService.getLocation()}catch(p){p instanceof GeolocationPositionError&&console.log("Error getting location")}a&&n.forEach(p=>p.location=a);try{const p=(0,C.n)(s.http.post(`${s.url}tracks/`,n,{headers:{Authorization:`Bearer ${s.token}`}}));n.forEach(U=>{const _={...U,id:U._id};console.log(_);const K=s.afs.collection("tracks").doc(U._id).ref;i.set(K,_)});const A=yield i.commit();return yield Promise.all([p,A]),!0}catch(p){if(p instanceof x.UA&&400===p.status)throw Error("Track already exists");return console.error(p),!1}})()}insertComment(n,s){var i=this;return(0,g.Z)(function*(){let a;try{a=yield i.geoService.getLocation()}catch(p){p instanceof GeolocationPositionError&&console.log("Error getting location")}a&&(s.location=a),s._id=L()().toHexString();try{const p=(0,C.n)(i.http.post(`${i.url}tracks/${n}/comments`,s,{headers:{Authorization:`Bearer ${i.token}`}})),A=i.afs.collection("tracks").doc(n).collection("comments").doc(s._id).set(s);return yield Promise.all([p,A]),!0}catch(p){return p instanceof x.UA&&404===p.status&&console.log("Track not found"),console.error(p),!1}})()}updateTrack(n){var s=this;return(0,g.Z)(function*(){try{const i=(0,C.n)(s.http.put(`${s.url}tracks/${n._id}`,n,{headers:{Authorization:`Bearer ${s.token}`}})),a=s.afs.collection("tracks").doc(n._id).update(n);return yield Promise.all([i,a]),!0}catch(i){return i instanceof x.UA&&(404===i.status&&console.log("Track not found"),500===i.status&&console.log("Error updating track")),!1}})()}deleteTrack(n){var s=this;return(0,g.Z)(function*(){try{const i=(0,C.n)(s.http.delete(`${s.url}tracks/${n}`,{headers:{Authorization:`Bearer ${s.token}`}})),a=s.afs.collection("tracks").doc(n).delete();return yield Promise.all([i,a]),!0}catch(i){return i instanceof x.UA&&(404===i.status&&console.log("Track not found"),500===i.status&&console.log("Error deleting track")),!1}})()}getComments(n){var s=this;return(0,g.Z)(function*(){let i=[];try{const a=(0,C.n)(s.http.get(`${s.url}tracks/${n}/comments`,{headers:{Authorization:`Bearer ${s.token}`}})),p=(0,O.z)(s.afs.collection("tracks").doc(n).collection("comments").valueChanges()),[A,U]=yield Promise.all([a,p]);i=A.concat(U.filter(_=>!A.find(K=>K._id===_._id)))}catch(a){a instanceof x.UA&&(404===a.status&&console.log("Track not found"),500===a.status&&console.log("Error getting comments"))}return i})()}deleteComment(n,s){var i=this;return(0,g.Z)(function*(){try{const a=(0,C.n)(i.http.delete(`${i.url}tracks/${n}/comments/${s}`,{headers:{Authorization:`Bearer ${i.token}`}})),p=i.afs.collection("tracks").doc(n).collection("comments").doc(s).delete();return yield Promise.all([a,p]),!0}catch(a){return a instanceof x.UA&&(404===a.status&&console.log("Track not found"),500===a.status&&console.log("Error deleting comment")),console.error(a),!1}})()}}return m.\u0275fac=function(n){return new(n||m)(u.LFG(x.eN),u.LFG(j.e),u.LFG(N),u.LFG(e.ST))},m.\u0275prov=u.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},2848:q=>{for(var B=Math.floor(16777215*Math.random()),b=u.index=parseInt(16777215*Math.random(),10),g=(typeof process>"u"||"number"!=typeof process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,x=(()=>{try{return _Buffer}catch{try{return Buffer}catch{return null}}})(),C=function(e){return!(null==e||!e.constructor||"function"!=typeof e.constructor.isBuffer||!e.constructor.isBuffer(e))},O=[],E=0;E<256;E++)O[E]=(E<=15?"0":"")+E.toString(16);var V=new RegExp("^[0-9a-fA-F]{24}$"),L=[];for(E=0;E<10;)L[48+E]=E++;for(;E<16;)L[55+E]=L[87+E]=E++;function u(e){if(!(this instanceof u))return new u(e);if(e&&(e instanceof u||"ObjectID"===e._bsontype))return e;if(this._bsontype="ObjectID",null!=e&&"number"!=typeof e){var f=u.isValid(e);if(!f&&null!=e)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(f&&"string"==typeof e&&24===e.length)return u.createFromHexString(e);if(null==e||12!==e.length){if(null!=e&&"function"==typeof e.toHexString)return e;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=e}else this.id=this.generate(e)}q.exports=u,u.default=u,u.createFromTime=function(e){return new u(function J(e,f){return(f=f.toString(16)).length===e?f:"00000000".substring(f.length,e)+f}(8,e=parseInt(e,10)%4294967295)+"0000000000000000")},u.createFromHexString=function(e){if(typeof e>"u"||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var f="",m=0;m<24;)f+=String.fromCharCode(L[e.charCodeAt(m++)]<<4|L[e.charCodeAt(m++)]);return new u(f)},u.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&V.test(e):e instanceof u||(C(e)?u.isValid(e.toString("hex")):!("function"!=typeof e.toHexString||!x||!(e.id instanceof x||"string"==typeof e.id))&&(12===e.id.length||24===e.id.length&&V.test(e.id)))))},u.prototype={constructor:u,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(24===this.id.length)return this.id;if(C(this.id))return this.id.toString("hex");for(var e="",f=0;f<this.id.length;f++)e+=O[this.id.charCodeAt(f)];return e},equals:function(e){return e instanceof u?this.toString()===e.toString():"string"==typeof e&&u.isValid(e)&&12===e.length&&C(this.id)?e===this.id.toString("binary"):"string"==typeof e&&u.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&u.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof u||e.toHexString))&&e.toHexString()===this.toHexString()},getTimestamp:function(){var f,e=new Date;return f=C(this.id)?this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,e.setTime(1e3*Math.floor(f)),e},generate:function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3)),e=parseInt(e,10)%4294967295;var f=function j(){return b=(b+1)%16777215}();return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e,B>>16&255,B>>8&255,255&B,g>>8&255,255&g,f>>16&255,f>>8&255,255&f)}};var N=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";u.prototype[N]=function(){return"ObjectID("+this+")"},u.prototype.toJSON=u.prototype.toHexString,u.prototype.toString=u.prototype.toHexString}}]);